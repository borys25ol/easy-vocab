<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phrasal Verbs Explorer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="/static/js/shared.js"></script>
    <style>
        /* Shared animations and card states */
        .details-container {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s ease, opacity 0.3s;
            opacity: 0;
        }

        .card-active .details-container {
            max-height: 800px;
            opacity: 1;
            margin-top: 1rem;
        }

        .blur-text {
            filter: blur(12px);
            transition: filter 0.3s;
        }

        .card-active .blur-text {
            filter: blur(0);
        }

        .chevron {
            transition: transform 0.3s ease;
        }

        .card-active .chevron {
            transform: rotate(180deg);
        }

        /* Level border styles */
        .lvl-a1 {
            border-left: 8px solid #22c55e !important;
        }

        .lvl-a2 {
            border-left: 8px solid #eab308 !important;
        }

        .lvl-b1 {
            border-left: 8px solid #0ea5e9 !important;
        }

        .lvl-b2 {
            border-left: 8px solid #a855f7 !important;
        }

        .lvl-c1 {
            border-left: 8px solid #f97316 !important;
        }

        .lvl-c2 {
            border-left: 8px solid #ef4444 !important;
        }

        /* Verb selector button styling */
        .active-verb {
            background: #4f46e5 !important;
            color: white !important;
            border-color: #4f46e5 !important;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
        }
    </style>
</head>
<body class="bg-slate-50 min-h-screen p-4 md:p-8 text-slate-900 font-sans">

<div class="max-w-2xl mx-auto">
    <header class="mb-10">
        <a href="/"
           class="text-xs font-bold text-slate-400 hover:text-indigo-600 transition-colors uppercase tracking-widest">‚Üê
            Back to Cards</a>
        <h1 class="text-4xl font-black text-slate-800 tracking-tight italic mt-4">PHRASAL <span class="text-indigo-600">VERBS</span>
        </h1>
        <p class="text-slate-500 text-sm mt-2">Explore verbs by their root component</p>
    </header>

    <div id="verbSelector" class="flex flex-wrap gap-2 mb-10 justify-center">
        <button onclick="loadPhrasal('Get')"
                class="verb-btn px-6 py-2 rounded-xl border bg-white font-bold text-slate-600 hover:bg-slate-50 transition-all shadow-sm">
            Get
        </button>
        <button onclick="loadPhrasal('Take')"
                class="verb-btn px-6 py-2 rounded-xl border bg-white font-bold text-slate-600 hover:bg-slate-50 transition-all shadow-sm">
            Take
        </button>
        <button onclick="loadPhrasal('Look')"
                class="verb-btn px-6 py-2 rounded-xl border bg-white font-bold text-slate-600 hover:bg-slate-50 transition-all shadow-sm">
            Look
        </button>
        <button onclick="loadPhrasal('Put')"
                class="verb-btn px-6 py-2 rounded-xl border bg-white font-bold text-slate-600 hover:bg-slate-50 transition-all shadow-sm">
            Put
        </button>
        <button onclick="loadPhrasal('Go')"
                class="verb-btn px-6 py-2 rounded-xl border bg-white font-bold text-slate-600 hover:bg-slate-50 transition-all shadow-sm">
            Go
        </button>
        <button onclick="loadPhrasal('Bring')"
                class="verb-btn px-6 py-2 rounded-xl border bg-white font-bold text-slate-600 hover:bg-slate-50 transition-all shadow-sm">
            Bring
        </button>
        <button onclick="loadPhrasal('Keep')"
                class="verb-btn px-6 py-2 rounded-xl border bg-white font-bold text-slate-600 hover:bg-slate-50 transition-all shadow-sm">
            Keep
        </button>
    </div>

    <div id="phrasalResultsCounter" class="text-xs font-bold text-slate-400 uppercase tracking-widest mb-6 text-center">
        Select a verb to start
    </div>

    <div id="phrasalList" class="space-y-4">
    </div>
</div>

<script>
    // FETCH PHRASAL VERBS FROM DATABASE
    async function loadPhrasal(root) {
        // Toggle active button style
        document.querySelectorAll('.verb-btn').forEach(btn => {
            btn.classList.toggle('active-verb', btn.innerText === root);
        });

        const response = await fetch(`/words/phrasal/${root}`);
        const words = await response.json();
        const list = document.getElementById('phrasalList');
        const counter = document.getElementById('phrasalResultsCounter');

        list.innerHTML = '';
        counter.innerText = `Found ${words.length} variants for "${root}"`;

        words.forEach(word => {
            // Use styles from shared.js
            const rankConfig = getRankConfig(word.frequency_group, word.type);
            const borderClass = getLevelBorderClass(word.level);
            const dotStyle = getLevelDotStyle(word.level);

            // Handle synonyms split by newline as per backend update
            const synonymsList = word.synonyms && word.synonyms !== "Synonyms not found"
                ? word.synonyms.split('\n').map(syn => `<div class="text-indigo-500 font-medium">‚Ä¢ ${syn}</div>`).join('')
                : '<span class="text-slate-300 italic text-xs">No synonyms found</span>';

            const card = document.createElement('div');
            card.id = `card-${word.id}`;
            card.className = `bg-white p-5 rounded-2xl shadow-sm transition-all ${borderClass}`;

            card.innerHTML = `
                <div class="flex justify-between items-start">
                    <div class="flex-1">
                        <div class="flex items-center flex-wrap gap-2">
                            <h3 class="text-xl font-bold text-slate-800">${word.word}</h3>
                            <button onclick="speak('${word.word.replace(/'/g, "\\'")}')" class="text-slate-300 hover:text-indigo-500 p-1">
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77zM16.5 12c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM7 9H3v6h4l5 5V4L7 9z"/></svg>
                            </button>
                            <span class="px-2 py-0.5 text-[9px] font-black uppercase tracking-wider rounded border ${rankConfig.badge}">
                                ${word.frequency_group} ${word.rank ? '#' + word.rank : ''}
                            </span>
                            <div class="flex items-center gap-1 text-[11px] font-bold text-slate-500">
                                <span class="${dotStyle} text-[14px]">‚óè</span>
                                <span>${word.level || 'A1'}</span>
                            </div>
                        </div>

                        <button onclick="toggleDetails(${word.id})" class="mt-2 text-indigo-500 text-[11px] font-bold flex items-center gap-1 uppercase">
                            <span>Details</span>
                            <svg class="chevron w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M19 9l-7 7-7-7"></path></svg>
                        </button>

                        <div class="details-container">
                            <div class="blur-text border-t border-slate-50 pt-3">
                                <p class="text-indigo-600 font-black text-xl mb-3">${word.translation}</p>
                                <div class="text-sm text-slate-500 italic border-l-2 border-slate-200 pl-4">
                                    ${word.examples ? word.examples.split('\n').join('<br>') : 'No examples'}
                                </div>
                            </div>

                            <div class="mt-4">
                                <span class="text-[9px] font-black text-slate-400 uppercase tracking-widest block mb-1">Synonyms</span>
                                <div class="space-y-1 text-sm">
                                    ${synonymsList}
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="flex items-center gap-1 ml-4">
                        <button onclick="toggleLearned(${word.id})" class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-green-50">${word.is_learned ? '‚úÖ' : '‚úîÔ∏è'}</button>
                        <button class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-indigo-50 text-slate-400">‚úèÔ∏è</button>
                        <button class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-red-50 text-slate-400">üóëÔ∏è</button>
                    </div>
                </div>
            `;
            list.appendChild(card);
        });
    }

    // Initialize voices
    window.speechSynthesis.onvoiceschanged = () => window.speechSynthesis.getVoices();
</script>
</body>
</html>