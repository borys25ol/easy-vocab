<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="/static/favicon.png">
    <title>Flashcards — English Learner PRO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="/static/css/cards.css">
    <style>
        .card-container {
            perspective: 1000px;
        }

        .card-inner {
            transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            transform-style: preserve-3d;
            position: relative;
            width: 100%;
            height: 100%;
        }

        .is-flipped .card-inner {
            transform: rotateY(180deg);
        }

        .card-front,
        .card-back {
            backface-visibility: hidden;
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            display: flex;
            flex-direction: column;
            border-left: none !important;
            /* Override common CSS for top border design */
        }

        .card-back {
            transform: rotateY(180deg);
        }

        .lvl-a1 {
            border-top: 12px solid #22c55e !important;
        }

        .lvl-a2 {
            border-top: 12px solid #eab308 !important;
        }

        .lvl-b1 {
            border-top: 12px solid #0ea5e9 !important;
        }

        .lvl-b2 {
            border-top: 12px solid #a855f7 !important;
        }

        .lvl-c1 {
            border-top: 12px solid #f97316 !important;
        }

        .lvl-c2 {
            border-top: 12px solid #ef4444 !important;
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 4px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #e2e8f0;
            border-radius: 10px;
        }
    </style>
</head>

<body class="bg-slate-50 min-h-screen flex flex-col items-center p-6 font-sans text-slate-900">

<div class="max-w-md w-full">
    <div class="flex justify-between items-center mb-6 px-2">
        <a href="/" class="text-slate-400 hover:text-slate-600 text-xs font-bold tracking-widest uppercase">←
            Back</a>
        <div id="counter" class="text-indigo-600 font-black text-xs uppercase tracking-[0.2em] italic text-right">0
            /
            0
        </div>
    </div>

    <div id="flashcard" class="card-container relative w-full h-[520px] cursor-pointer group">
        <div class="card-inner">
            <div id="front"
                 class="card-front bg-white rounded-[3rem] shadow-2xl shadow-indigo-100 flex items-center justify-center p-10 border-b-4 border-slate-100">
                <div class="text-center">
                    <div id="frontLevelBadge"
                         class="text-[10px] font-black px-3 py-1 rounded-full bg-slate-100 text-slate-500 uppercase tracking-widest mb-6 inline-block">
                        ...
                    </div>
                    <h2 id="wordText" class="text-4xl font-black text-slate-800 leading-tight">...</h2>
                    <div class="mt-12 flex flex-col items-center gap-3">
                        <div class="w-12 h-12 rounded-full bg-slate-50 flex items-center justify-center text-slate-300 group-hover:scale-110 group-hover:bg-indigo-50 group-hover:text-indigo-500 transition-all duration-300">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5"
                                      d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4"></path>
                            </svg>
                        </div>
                        <p class="text-[10px] text-slate-300 font-bold uppercase tracking-[0.2em]">Tap to flip</p>
                    </div>
                </div>
            </div>

            <div id="back"
                 class="card-back bg-white rounded-[3rem] shadow-2xl p-8 border-b-4 border-indigo-50 overflow-hidden">
                <div class="flex flex-col h-full">
                    <div class="flex justify-between items-start mb-6">
                        <div class="text-left">
                                <span id="typeTag" class="text-[9px] font-black uppercase text-indigo-400 tracking-widest">WORD</span>
                            <h3 id="translationText" class="text-2xl font-black text-slate-800 mt-1">...</h3>
                        </div>
                        <div class="text-right">
                            <div id="backLevelTag" class="text-xs font-black text-slate-800 uppercase">...</div>
                            <div id="backRankTag" class="text-[9px] font-bold text-slate-400 mt-1">#0</div>
                        </div>
                    </div>

                    <div class="grid grid-cols-2 gap-2 mb-6 text-center">
                        <div class="bg-slate-50 p-3 rounded-2xl border border-slate-100">
                            <p class="text-[7px] font-black text-slate-400 uppercase tracking-widest">Frequency</p>
                            <p id="freqGroupText" class="text-[10px] font-black text-slate-700 mt-1 uppercase">...</p>
                        </div>
                        <div class="bg-slate-50 p-3 rounded-2xl border border-slate-100">
                            <p class="text-[7px] font-black text-slate-400 uppercase tracking-widest">Range</p>
                            <p id="rankRangeText" class="text-[10px] font-black text-slate-700 mt-1 uppercase">...
                            </p>
                        </div>
                    </div>

                    <div class="flex-1 overflow-y-auto pr-2 custom-scrollbar">
                        <div class="border-t border-slate-100 pt-4">
                                <span class="text-[9px] font-black uppercase text-slate-400 block mb-3 tracking-widest italic">Examples:</span>
                            <div id="examplesContainer"
                                 class="text-sm text-slate-600 italic leading-relaxed space-y-3"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="mt-8 space-y-4">
        <div class="grid grid-cols-2 gap-4">
            <button onclick="prevCard()" id="prevBtn"
                    class="bg-white border-2 border-slate-100 text-slate-400 py-4 rounded-3xl font-black hover:bg-slate-50 transition-all shadow-sm disabled:opacity-30 disabled:cursor-not-allowed uppercase text-xs">
                ← Prev
            </button>
            <button onclick="nextCard()" id="nextBtn"
                    class="bg-indigo-600 text-white py-4 rounded-3xl font-black hover:bg-indigo-700 transition-all shadow-lg shadow-indigo-200 disabled:opacity-30 uppercase text-xs">
                Next →
            </button>
        </div>
        <button onclick="toggleLearnedStatus()" id="learnedBtn"
                class="w-full bg-white border-2 border-slate-100 text-slate-500 py-4 rounded-3xl font-black text-[10px] hover:border-indigo-200 transition-all uppercase tracking-[0.2em] flex items-center justify-center gap-2">
            <span id="learnedLabel">Mark as Learned</span>
            <span id="learnedIcon">⬜</span>
        </button>
    </div>
</div>

<script>
    let cards = [];
    let currentIndex = 0;

    function getLevelClass(level) {
        return `lvl-${(level || 'A1').toLowerCase()}`;
    }

    async function initFlashcards() {
        try {
            const response = await fetch('/words');
            const data = await response.json();
            cards = data.sort((a, b) => (a.rank || 99999) - (b.rank || 99999));
            if (cards.length > 0) updateCard();
        } catch (e) {
            console.error("Data error:", e);
        }
    }

    function updateCard() {
        const word = cards[currentIndex];
        const flashcard = document.getElementById('flashcard');
        flashcard.classList.remove('is-flipped');

        setTimeout(() => {
            document.getElementById('wordText').innerText = word.word;
            document.getElementById('translationText').innerText = word.translation;
            document.getElementById('counter').innerText = `${currentIndex + 1} / ${cards.length}`;

            const lvlClass = getLevelClass(word.level);
            document.getElementById('frontLevelBadge').innerText = word.level || 'A1';
            document.getElementById('backLevelTag').innerText = word.level || 'A1';

            const front = document.getElementById('front');
            const back = document.getElementById('back');
            front.className = `card-front bg-white rounded-[3rem] shadow-2xl p-10 border-b-4 border-slate-100 ${lvlClass}`;
            back.className = `card-back bg-white rounded-[3rem] shadow-2xl p-8 border-b-4 border-indigo-50 overflow-hidden ${lvlClass}`;

            let typeLabel = word.type.toUpperCase();
            if (word.is_phrasal) typeLabel = "PHRASAL VERB";
            if (word.is_idiom) typeLabel = "IDIOM";
            document.getElementById('typeTag').innerText = typeLabel;

            document.getElementById('backRankTag').innerText = `#${word.rank || '?'}`;
            document.getElementById('freqGroupText').innerText = word.frequency_group || '-';
            document.getElementById('rankRangeText').innerText = word.rank_range || '-';

            if (word.examples && word.examples !== "Examples not found") {
                document.getElementById('examplesContainer').innerHTML = word.examples
                    .split('\n')
                    .map(ex => `
                        <div class="bg-slate-50/50 p-3 rounded-2xl border border-slate-100 text-[13px] hover:bg-white transition-colors">
                            <span class="text-indigo-400 mr-2">•</span>${ex}
                        </div>
                    `).join('');
            } else {
                document.getElementById('examplesContainer').innerHTML = `
                    <div class="text-slate-300 italic text-center py-6 flex flex-col items-center gap-2">
                        <svg class="w-8 h-8 opacity-20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                        </svg>
                        <span class="text-xs uppercase tracking-widest opacity-60">No examples available</span>
                    </div>
                `;
            }

            document.getElementById('prevBtn').disabled = currentIndex === 0;
            document.getElementById('nextBtn').disabled = currentIndex === cards.length - 1;

            const lBtn = document.getElementById('learnedBtn');

            if (word.is_learned) {
                lBtn.classList.add('border-green-500', 'text-green-600', 'bg-green-50');
                document.getElementById('learnedLabel').innerText = "Learned";
                document.getElementById('learnedIcon').innerText = "✅";
            } else {
                lBtn.classList.remove('border-green-500', 'text-green-600', 'bg-green-50');
                document.getElementById('learnedLabel').innerText = "Mark as Learned";
                document.getElementById('learnedIcon').innerText = "⬜";
            }
        }, 100);
    }

    function nextCard() {
        if (currentIndex < cards.length - 1) {
            currentIndex++;
            updateCard();
        }
    }

    function prevCard() {
        if (currentIndex > 0) {
            currentIndex--;
            updateCard();
        }
    }

    async function toggleLearnedStatus() {
        const word = cards[currentIndex];
        const response = await fetch(`/words/${word.id}/toggle_learned`, {method: 'PATCH'});
        if (response.ok) {
            const updated = await response.json();
            cards[currentIndex].is_learned = updated.is_learned;
            updateCard();
        }
    }

    document.getElementById('flashcard').onclick = function () {
        this.classList.toggle('is-flipped');
    };

    document.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowRight') nextCard();
        if (e.key === 'ArrowLeft') prevCard();
        if (e.key === ' ' || e.key === 'Enter') {
            e.preventDefault();
            document.getElementById('flashcard').click();
        }
    });

    initFlashcards();
</script>
</body>
</html>
